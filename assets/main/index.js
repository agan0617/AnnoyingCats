System.register("chunks:///_virtual/CatBlock.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts"],(function(t){var i,o,n,e,s,r,a,l,h,c,d,g,u,_;return{setters:[function(t){i=t.inheritsLoose},function(t){o=t.cclegacy,n=t._decorator,e=t.Input,s=t.instantiate,r=t.UIOpacity,a=t.Sprite,l=t.Color,h=t.UITransform,c=t.v3,d=t.tween,g=t.Vec3,u=t.Component},function(t){_=t.GameController}],execute:function(){var f;o._RF.push({},"330d0kLYqlGBLtt8jYyjfE9","CatBlock",void 0);var k=n.ccclass;n.property,t("CatBlock",k("CatBlock")(f=function(t){function o(){for(var i,o=arguments.length,n=new Array(o),e=0;e<o;e++)n[e]=arguments[e];return(i=t.call.apply(t,[this].concat(n))||this).gridManager=null,i.blockId="",i.size=1,i.row=-1,i.col=-1,i._isDragging=!1,i._startPos=new g,i._dragOffset=new g,i._shadowBlock=null,i}i(o,t);var n=o.prototype;return n.onLoad=function(){this._registerTouchEvents()},n._registerTouchEvents=function(){this.node.on(e.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(e.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(e.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(e.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},n.onTouchStart=function(t){_.isInputLocked||(this._isDragging=!0,this._startPos=this.node.position.clone(),this.node.setSiblingIndex(999),this._createShadowBlock(),this._calculateDragOffset(t))},n.onTouchMove=function(t){if(!_.isInputLocked&&this._isDragging){var i=this._calculateTargetPosition(t);i&&this.node.setPosition(i.x,this._startPos.y,this._startPos.z)}},n.onTouchEnd=function(t){_.isInputLocked||(this._isDragging=!1,this._removeShadowBlock(),this._tryPlaceBlock())},n._createShadowBlock=function(){if(!this._shadowBlock){this._shadowBlock=s(this.node),this._shadowBlock.name=this.node.name+"_shadow",this._shadowBlock.setParent(this.node.parent),this._shadowBlock.setPosition(this._startPos),this._shadowBlock.setSiblingIndex(998),(this._shadowBlock.getComponent(r)||this._shadowBlock.addComponent(r)).opacity=120;var t=this._shadowBlock.getComponent(a);t&&(t.color=new l(100,200,255,255))}},n._removeShadowBlock=function(){this._shadowBlock&&(this._shadowBlock.destroy(),this._shadowBlock=null)},n._calculateDragOffset=function(t){var i=t.getUILocation(),o=this.node.parent.getComponent(h).convertToNodeSpaceAR(c(i.x,i.y));this._dragOffset=c(o.x-this.node.position.x,o.y-this.node.position.y)},n._calculateTargetPosition=function(t){var i=t.getUILocation(),o=this.node.parent.getComponent(h).convertToNodeSpaceAR(c(i.x,i.y)).x-this._dragOffset.x,n=this._calculateLeftColumn(o);return this._canMoveToColumn(n)?this.gridManager.getCellPosition(this.row,n,this.size):null},n._calculateLeftColumn=function(t){var i=t-this.size/2*this.gridManager.cellSize+this.gridManager.cellSize/2,o=Math.round((i+this.gridManager.cols*this.gridManager.cellSize/2-this.gridManager.cellSize/2)/this.gridManager.cellSize),n=(o=Math.max(0,Math.min(this.gridManager.cols-this.size,o)))+this.size-1;return n>=this.gridManager.cols&&(o=(n=this.gridManager.cols-1)-this.size+1),o},n._canMoveToColumn=function(t){return!!this._isPathClear(t)&&this._isTargetAreaClear(t)},n._isPathClear=function(t){if(t===this.col)return!0;for(var i=t<this.col?t:this.col,o=t<this.col?this.col:t,n=i;n<=o;n++)for(var e=0;e<this.size;e++){var s=this.gridManager.grid[this.row][n+e];if(null!==s.block&&s.blockId!==this.blockId)return!1}return!0},n._isTargetAreaClear=function(t){for(var i=0;i<this.size;i++){var o=this.gridManager.grid[this.row][t+i];if(null!==o.block&&o.blockId!==this.blockId)return!1}return!0},n._tryPlaceBlock=function(){var t=this._calculateFinalColumn();this._isTargetAreaClear(t)&&this._placeBlockAtColumn(t)},n._calculateFinalColumn=function(){var t=this.node.getPosition().x-(this.size-1)/2*this.gridManager.cellSize,i=Math.round((t+this.gridManager.cols*this.gridManager.cellSize/2-this.gridManager.cellSize/2)/this.gridManager.cellSize);return Math.max(0,Math.min(this.gridManager.cols-this.size,i))},n._placeBlockAtColumn=function(t){if(this.col!==t){this._clearOldGridCells(),this._updateNewGridCells(t),this.col=t;var i=this.gridManager.getCellPosition(this.row,this.col,this.size);this.node.setPosition(i),this._handlePostPlacement()}},n._clearOldGridCells=function(){for(var t=0;t<this.gridManager.cols;t++){this.gridManager.grid[this.row][t].blockId===this.blockId&&(this.gridManager.grid[this.row][t]={block:null,blockId:null})}},n._updateNewGridCells=function(t){for(var i=0;i<this.size;i++)this.gridManager.grid[this.row][t+i]={block:this.node,blockId:this.blockId}},n._handlePostPlacement=function(){var t=this;this.gridManager.fallAndClearBlocks().then((function(){_.instance.slideCountThisRound--,_.instance.remainningMoveLabel&&(_.instance.remainningMoveLabel.string="Moves: "+_.instance.slideCountThisRound),t._shouldStartNextRound()&&_.instance.onNextRound()}))},n._shouldStartNextRound=function(){return _.instance.slideCountThisRound<=0||this.gridManager.countRowsWithAnyBlockFromBottom()<3},n.fallDown=function(){var t=this;return new Promise((function(i){var o=.2;!function n(){t.row>=t.gridManager.rows-1?i():t._canFallDown()?(t._performFallStep(o,n),o=Math.max(.7*o,.02)):i()}()}))},n._canFallDown=function(){for(var t=0;t<this.size;t++){if(null!==this.gridManager.grid[this.row+1][this.col+t].block)return!1}return!0},n._performFallStep=function(t,i){this._clearOldGridCells(),this.row++;for(var o=0;o<this.size;o++)this.gridManager.grid[this.row][this.col+o]={block:this.node,blockId:this.blockId};var n=this.gridManager.getCellPosition(this.row,this.col,this.size);d(this.node).to(t,{position:n},{easing:"quadInOut"}).call(i).start()},o}(u))||f);o._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GridManager.ts","./LeaderboardDisplay.ts","./InputNamePanel.ts"],(function(e){var t,a,i,n,r,o,l,u,s,c,h,d,m,p,f,g,b,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized,r=e.createClass,o=e.asyncToGenerator,l=e.regeneratorRuntime},function(e){u=e.cclegacy,s=e._decorator,c=e.Node,h=e.Label,d=e.Camera,m=e.AudioClip,p=e.AudioSource,f=e.Component},function(e){g=e.GridManager},function(e){b=e.LeaderboardDisplay},function(e){y=e.InputNamePanel}],execute:function(){var v,L,w,C,P,S,k,N,M,R,A,T,z,D,I,_,B,G,x,O,H,F,U,j,J,W,K,X,q,E;u._RF.push({},"27593fHHN1DuKwRXJmfIcU2","GameController",void 0);var Q=s.ccclass,V=s.property;e("GameController",(v=Q("GameController"),L=V({type:g}),w=V({type:c}),C=V({type:c}),P=V({type:c}),S=V({type:y}),k=V({type:b}),N=V({type:h}),M=V({type:h}),R=V({type:h}),A=V({type:h}),T=V({type:h}),z=V({type:d}),D=V({type:[m]}),v(((E=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,i(t,"gridManager",B,n(t)),i(t,"rankingPanel",G,n(t)),i(t,"gameOverPanel",x,n(t)),i(t,"showNamePanel",O,n(t)),i(t,"inputNamePanel",H,n(t)),i(t,"leaderboardDisplay",F,n(t)),i(t,"scoreLabel",U,n(t)),i(t,"timeLabel",j,n(t)),i(t,"levelLabel",J,n(t)),i(t,"remainningMoveLabel",W,n(t)),i(t,"nameLabel",K,n(t)),i(t,"mainCamera",X,n(t)),i(t,"audioClips",q,n(t)),t.playerName="",t.totalScore=0,t.originalCameraOrthoHeight=0,t.leaderboard=[],t._audioSource=null,t.gameTimer=0,t.difficulty=1,t.timerRunning=!1,t.slideCountThisRound=0,t}a(t,e),t.lockInput=function(){t.isInputLocked=!0},t.unlockInput=function(){t.isInputLocked=!1};var u=t.prototype;return u.onLoad=function(){this.initializeSingleton(),this.loadGameData(),this.initializeCamera()},u.start=function(){this.adjustCamera(),this.onResetBoard()},u.update=function(e){this.updateGameTimer(e)},u.initializeSingleton=function(){t._instance=this},u.loadGameData=function(){this.loadLeaderboardFromLocal(),this.loadPlayerNameFromLocal()},u.initializeCamera=function(){this.mainCamera&&void 0!==this.mainCamera.orthoHeight&&(this.originalCameraOrthoHeight=this.mainCamera.orthoHeight,console.log("Original Camera Ortho Height:",this.originalCameraOrthoHeight))},u.adjustCamera=function(){this.mainCamera&&void 0!==this.mainCamera.orthoHeight&&(this.mainCamera.orthoHeight=1.1*this.originalCameraOrthoHeight)},u.onResetBoard=function(){var e=o(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.resetGameState(),this.updateUI(),this.gridManager.resetBoard(),this.onNextRound();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.onNextRound=function(){var e=o(l().mark((function e(){var a,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.unlockInput(),this.updateSlideCount(),a=this.gridManager.countRowsWithAnyBlockFromBottom(),i=this.calculateAddRows(a),this.gridManager.moveAllBlocksUp(i)){e.next=8;break}return this.showGameOverPanel(),e.abrupt("return");case 8:return e.next=10,this.gridManager.addNewRow(!0,i);case 10:return e.next=12,this.gridManager.fallAndClearBlocks();case 12:this.ensureMinimumRows();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.resetGameState=function(){this.totalScore=0,this.gameTimer=0,this.timerRunning=!0,this.difficulty=1},u.updateUI=function(){this.rankingPanel.active=!1,this.showNamePanel.active=!0,this.updateLevelDisplay()},u.updateSlideCount=function(){this.slideCountThisRound=1},u.calculateAddRows=function(e){var t=this.difficulty;return 1===t?e<5&&(t=5-e):t=this.limitAddRowsByCurrentRows(t,e),t},u.limitAddRowsByCurrentRows=function(e,t){return t>=8?Math.min(1,e):7===t?Math.min(2,e):6===t?Math.min(3,e):5===t?Math.min(4,e):4===t?Math.min(5,e):3===t?Math.min(6,e):2===t?Math.min(7,e):e},u.ensureMinimumRows=function(){var e=o(l().mark((function e(){var t,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.gridManager.countRowsWithAnyBlockFromBottom();case 1:if(!(t<3)){e.next=11;break}return a=3-t,this.gridManager.moveAllBlocksUp(a),e.next=6,this.gridManager.addNewRow(!0,a);case 6:return e.next=8,this.gridManager.fallAndClearBlocks();case 8:t=this.gridManager.countRowsWithAnyBlockFromBottom(),e.next=1;break;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.updateGameTimer=function(e){this.timerRunning&&(this.gameTimer+=e,this.updateDifficulty(),this.updateTimeDisplay())},u.updateDifficulty=function(){var e=Math.min(9,1+Math.floor(this.gameTimer/30));e!==this.difficulty&&(this.difficulty=e,this.updateLevelDisplay())},u.updateTimeDisplay=function(){this.timeLabel&&(this.timeLabel.string="Time: "+Math.floor(this.gameTimer).toString())},u.updateLevelDisplay=function(){this.levelLabel&&(this.levelLabel.string="Level: "+this.difficulty)},u.PlaySound=function(e){this.audioClips&&this.audioClips[e]?(this.ensureAudioSource(),this._audioSource.clip=this.audioClips[e],this._audioSource.play()):console.warn("音效 clip 不存在，index:",e)},u.ensureAudioSource=function(){if(!this._audioSource){var e=new c("SoundPlayer");this.node.addChild(e),this._audioSource=e.addComponent(p)}},u.showGameOverPanel=function(){this.rankingPanel&&(this.rankingPanel.active=!0,this.gameOverPanel.active=!0,this.showNamePanel.active=!1,this.tryAddToLeaderboard(this.totalScore,this.playerName),this.leaderboardDisplay.setLeaderboard(this.getLeaderboard()),t.lockInput(),this.timerRunning=!1)},u.showRankingPanel=function(){if(this.rankingPanel){var e=!this.rankingPanel.active;this.rankingPanel.active=e,this.gameOverPanel.active=!1,e?(this.leaderboardDisplay.setLeaderboard(this.getLeaderboard()),t.lockInput(),this.timerRunning=!1):(t.unlockInput(),this.timerRunning=!0)}},u.addScore=function(e){var t=Math.min(3,this.difficulty);this.totalScore+=e*t,this.scoreLabel.string="Score: "+this.totalScore.toString()},u.getLeaderboard=function(){return this.leaderboard.slice()},u.tryAddToLeaderboard=function(e,t){void 0===t&&(t="Player"),this.leaderboard.push({name:t,score:e}),this.sortAndLimitLeaderboard(),this.saveLeaderboardToLocal()},u.sortAndLimitLeaderboard=function(){this.leaderboard.sort((function(e,t){return t.score-e.score})),this.leaderboard.length>10&&(this.leaderboard.length=10)},u.saveLeaderboardToLocal=function(){try{localStorage.setItem("haru_leaderboard",JSON.stringify(this.leaderboard))}catch(e){console.warn("寫入排行榜到 localStorage 失敗",e)}},u.loadLeaderboardFromLocal=function(){try{var e=localStorage.getItem("haru_leaderboard");e&&(this.leaderboard=JSON.parse(e))}catch(e){console.warn("讀取排行榜資料失敗",e)}},u.setPlayerName=function(e){this.playerName=e,this.nameLabel.string="Name: "+this.playerName,this.savePlayerNameToLocal()},u.getPlayerName=function(){return this.playerName},u.savePlayerNameToLocal=function(){try{localStorage.setItem("haru_player_name",this.playerName)}catch(e){console.warn("寫入玩家名稱到 localStorage 失敗",e)}},u.loadPlayerNameFromLocal=function(){try{var e=localStorage.getItem("haru_player_name");e&&(this.playerName=e,this.nameLabel.string="Name: "+this.playerName)}catch(e){console.warn("讀取玩家名稱失敗",e)}},r(t,null,[{key:"instance",get:function(){return t._instance}}]),t}(f))._instance=null,E.isInputLocked=!1,B=t((_=E).prototype,"gridManager",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(_.prototype,"rankingPanel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(_.prototype,"gameOverPanel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(_.prototype,"showNamePanel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(_.prototype,"inputNamePanel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(_.prototype,"leaderboardDisplay",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(_.prototype,"scoreLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(_.prototype,"timeLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(_.prototype,"levelLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(_.prototype,"remainningMoveLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(_.prototype,"nameLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(_.prototype,"mainCamera",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(_.prototype,"audioClips",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),I=_))||I));u._RF.pop()}}}));

System.register("chunks:///_virtual/GridManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CatBlock.ts","./GameController.ts"],(function(t){var e,r,n,o,i,l,c,a,s,u,f,h,k,d,p,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,i=t.asyncToGenerator,l=t.regeneratorRuntime},function(t){c=t.cclegacy,a=t._decorator,s=t.Prefab,u=t.instantiate,f=t.Vec3,h=t.tween,k=t.UIOpacity,d=t.Component},function(t){p=t.CatBlock},function(t){b=t.GameController}],execute:function(){var v,w,x,g,m,y,B,P,S,z,I,C,G;c._RF.push({},"cde18A5GxdHQLw+7uOuLQLa","GridManager",void 0);var A=a.ccclass,R=a.property;t("GridManager",(v=A("GridManager"),w=R({type:s}),x=R({type:s}),g=R({type:s}),m=R({type:s}),y=R({type:s}),v((S=e((P=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return e=t.call.apply(t,[this].concat(i))||this,n(e,"cellPrefab",S,o(e)),n(e,"catBlockPrefab1x1",z,o(e)),n(e,"catBlockPrefab1x2",I,o(e)),n(e,"catBlockPrefab1x3",C,o(e)),n(e,"catBlockPrefab1x4",G,o(e)),e.rows=10,e.cols=8,e.cellSize=90,e.grid=[],e}r(e,t);var c=e.prototype;return c.onLoad=function(){this.generateGrid()},c.generateGrid=function(){this.initializeGridArray(),this.createGridCells()},c.initializeGridArray=function(){this.grid=[];for(var t=0;t<this.rows;t++){this.grid[t]=[];for(var e=0;e<this.cols;e++)this.grid[t][e]={block:null,blockId:null}}},c.createGridCells=function(){for(var t=-this.cols*this.cellSize/2+this.cellSize/2,e=this.rows*this.cellSize/2-this.cellSize/2,r=0;r<this.rows;r++)for(var n=0;n<this.cols;n++){var o=u(this.cellPrefab),i=new f(t+n*this.cellSize,e-r*this.cellSize,0);o.setPosition(i),this.node.addChild(o)}},c.moveAllBlocksUp=function(t){if(void 0===t&&(t=1),!this.canMoveBlocksUp(t))return!1;var e=this.createEmptyGrid();return this.moveBlocksToNewGrid(t,e),this.grid=e,!0},c.canMoveBlocksUp=function(t){for(var e=0;e<t;e++)for(var r=0;r<this.cols;r++)if(null!=this.grid[e][r].block)return!1;return!0},c.createEmptyGrid=function(){for(var t=[],e=0;e<this.rows;e++){t[e]=[];for(var r=0;r<this.cols;r++)t[e][r]={block:null,blockId:null}}return t},c.moveBlocksToNewGrid=function(t,e){for(var r=t;r<this.rows;r++)for(var n=0;n<this.cols;){var o=this.grid[r][n];if(o.block&&o.blockId)this.moveSingleBlock(o,r,t,e),n+=o.block.getComponent(p).size;else n++}},c.moveSingleBlock=function(t,e,r,n){var o=t.block.getComponent(p),i=o.size,l=o.col,c=e-r;o.row=c,o.col=l;var a=this.calculateBlockPosition(c,l,i);t.block.setPosition(a);for(var s=0;s<i;s++)n[c][l+s]={block:t.block,blockId:t.blockId}},c.calculateBlockPosition=function(t,e,r){if(1===r)return this.getCellPosition(t,e);var n=this.getCellPosition(t,e),o=this.getCellPosition(t,e+r-1);return new f((n.x+o.x)/2,(n.y+o.y)/2,(n.z+o.z)/2)},c.addNewRow=function(){var t=i(l().mark((function t(e,r){var n,o,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(void 0===e&&(e=!1),void 0===r&&(r=1),b.instance.PlaySound(1),b.lockInput(),n=[],o=0;o<r;o++)i=this.generateSingleRow(this.rows-1-o,e),e&&n.push(i);if(!e){t.next=9;break}return t.next=9,Promise.all(n);case 9:b.unlockInput();case 10:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),c.generateSingleRow=function(){var t=i(l().mark((function t(e,r){var n,o,i,c,a,s,u,f,h;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Math.floor(3*Math.random())+2,o=new Array(this.cols).fill(!1),i=0,c=0,a=10,s=[];case 6:if(!(i<n&&c<a)){t.next=17;break}if(c++,0!==(u=this.findPossiblePlacements(o)).length){t.next=11;break}return t.abrupt("break",17);case 11:f=this.selectRandomPlacement(u),h=this.spawnCatBlock(f.size,e,f.col,o,r),r&&s.push(h),i++,t.next=6;break;case 17:if(!r){t.next=20;break}return t.next=20,Promise.all(s);case 20:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),c.findPossiblePlacements=function(t){for(var e=[],r=1;r<=4;r++)for(var n=0;n<=this.cols-r;n++){if(this.canPlaceBlock(r,n,t))this.simulatePlacement(r,n,t).every((function(t){return t}))||e.push({size:r,col:n})}return e},c.canPlaceBlock=function(t,e,r){for(var n=0;n<t;n++)if(r[e+n])return!1;return!0},c.simulatePlacement=function(t,e,r){for(var n=r.slice(),o=0;o<t;o++)n[e+o]=!0;return n},c.selectRandomPlacement=function(t){return t[Math.floor(Math.random()*t.length)]},c.addNewRowTest=function(){for(var t=1;t<3;t++){var e=new Array(this.cols).fill(!1);this.spawnCatBlock(4,this.rows-t,0,e,!1)}},c.spawnCatBlock=function(t,e,r,n,o){var i=this;return void 0===o&&(o=!1),b.lockInput(),new Promise((function(l){var c=i.getBlockPrefabBySize(t),a=i.createBlockNode(c,e,r,t);i.setupBlockProperties(a,t,e,r),i.markGridPositions(a,e,r,t,n),o?i.playSpawnAnimation(a,l):(b.unlockInput(),l())}))},c.getBlockPrefabBySize=function(t){switch(t){case 2:return this.catBlockPrefab1x2;case 3:return this.catBlockPrefab1x3;case 4:return this.catBlockPrefab1x4;default:return this.catBlockPrefab1x1}},c.createBlockNode=function(t,e,r,n){var o=u(t);o.setParent(this.node.parent),o.getComponent(p).gridManager=this;var i=this.getCellPosition(e,r,n);return o.setPosition(i),o},c.setupBlockProperties=function(t,e,r,n){var o=t.getComponent(p);o.blockId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),o.size=e,o.row=r,o.col=n},c.markGridPositions=function(t,e,r,n,o){for(var i=t.getComponent(p),l=0;l<n;l++)this.grid[e][r+l]={block:t,blockId:i.blockId},o[r+l]=!0},c.playSpawnAnimation=function(t,e){t.setScale(0,0,0),h(t).to(.3,{scale:new f(1,1,1)},{easing:"backOut"}).call((function(){b.unlockInput(),e()})).start()},c.fallAndClearBlocks=function(){var t=i(l().mark((function t(){var e,r,n,o,i,c,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:b.lockInput(),e=!0,r=0,n=0;case 4:if(!e){t.next=16;break}return o=this.getGridSnapshot(),t.next=8,this.fallAllBlocksDown();case 8:return t.next=10,this.checkAndClearFullRows();case 10:(i=t.sent)&&(r++,c=Math.pow(2,r-1),n+=c),a=this.getGridSnapshot(),e=JSON.stringify(o)!==JSON.stringify(a)||i,t.next=4;break;case 16:n+=this.calculateBonusScore(),b.instance.addScore(n),b.unlockInput();case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.getGridSnapshot=function(){return this.grid.map((function(t){return t.map((function(t){return t.blockId}))}))},c.calculateBonusScore=function(){var t=this.countRowsWithAnyBlockFromBottom();return 0===t?50:1===t?20:2===t?10:0},c.fallAllBlocksDown=function(){for(var t=new Set,e=[],r=this.rows-2;r>=0;r--)for(var n=0;n<this.cols;n++){var o=this.grid[r][n];if(o.block&&o.blockId&&!t.has(o.blockId)){var i=o.block.getComponent(p);e.push(i.fallDown()),t.add(o.blockId)}}return Promise.all(e)},c.checkAndClearFullRows=function(){var t=i(l().mark((function t(){var e;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.rows-1;case 1:if(!(e>=0)){t.next=9;break}if(!this.isRowFull(e)){t.next=6;break}return t.next=5,this.clearFullRow(e);case 5:return t.abrupt("return",!0);case 6:e--,t.next=1;break;case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.isRowFull=function(t){return this.grid[t].every((function(t){return null!==t.block}))},c.clearFullRow=function(){var t=i(l().mark((function t(e){var r,n,o,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(b.instance.PlaySound(0),r=new Set,n=[],o=0;o<this.cols;o++)(i=this.grid[e][o]).block&&!r.has(i.blockId)&&(n.push(this.destroyBlockWithAnimation(i.block)),r.add(i.blockId)),this.grid[e][o]={block:null,blockId:null};return t.next=6,Promise.all(n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.destroyBlockWithAnimation=function(t){return new Promise((function(e){var r=t.getComponent(k);r?h(r).to(.5,{opacity:0}).call((function(){t.destroy(),e()})).start():(t.destroy(),e())}))},c.isBottomRowsAllHaveBlock=function(t){for(var e=this.rows-1;e>=this.rows-t&&e>=0;e--)if(!this.hasAnyBlockInRow(e))return!1;return!0},c.countRowsWithAnyBlockFromBottom=function(){for(var t=0,e=this.rows-1;e>=0&&this.hasAnyBlockInRow(e);e--)t++;return t},c.hasAnyBlockInRow=function(t){for(var e=0;e<this.cols;e++)if(null!=this.grid[t][e].block)return!0;return!1},c.getCellPosition=function(t,e,r){void 0===r&&(r=1);var n=-this.cols*this.cellSize/2+this.cellSize/2+e*this.cellSize,o=this.rows*this.cellSize/2-this.cellSize/2-t*this.cellSize;if(1===r)return new f(n,o,0);var i=-this.cols*this.cellSize/2+this.cellSize/2+(e+r-1)*this.cellSize,l=this.rows*this.cellSize/2-this.cellSize/2-t*this.cellSize;return new f((n+i)/2,(o+l)/2,0)},c.resetBoard=function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.cols;e++){var r=this.grid[t][e];r.block&&r.block.destroy(),this.grid[t][e]={block:null,blockId:null}}},c.logBoard=function(){for(var t="\n",e=new Set,r=0;r<this.rows;r++){for(var n="",o=0;o<this.cols;o++){var i=this.grid[r][o];if(i.blockId&&i.block)if(e.has(i.blockId))n+="·· ";else{var l=i.block.getComponent(p);n+=(l&&l.name?l.name:"??")+" ",e.add(i.blockId)}else n+="__ "}t+=n+"\n"}console.log(t)},e}(d)).prototype,"cellPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(P.prototype,"catBlockPrefab1x1",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"catBlockPrefab1x2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(P.prototype,"catBlockPrefab1x3",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(P.prototype,"catBlockPrefab1x4",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=P))||B));c._RF.pop()}}}));

System.register("chunks:///_virtual/InputNamePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts"],(function(n){var t,e,i,r,o,a,c,l,u;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,r=n.assertThisInitialized},function(n){o=n.cclegacy,a=n._decorator,c=n.EditBox,l=n.Component},function(n){u=n.GameController}],execute:function(){var s,p,f,m,h;o._RF.push({},"1301d/fMnVBaY5npXdISJvc","InputNamePanel",void 0);var g=a.ccclass,v=a.property;n("InputNamePanel",(s=g("InputNamePanel"),p=v(c),s((h=t((m=function(n){function t(){for(var t,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return t=n.call.apply(n,[this].concat(o))||this,i(t,"inputBox",h,r(t)),t}e(t,n);var o=t.prototype;return o.show=function(){u.lockInput(),u.instance.timerRunning=!1,this.node.active=!0,this.inputBox.string=u.instance.getPlayerName()||""},o.onClickConfirm=function(){var n=this.inputBox.string.trim();""!==n&&(u.instance.setPlayerName(n),console.log("玩家名稱設定為：",n)),this.node.active=!1,u.unlockInput(),u.instance.timerRunning=!0},t}(l)).prototype,"inputBox",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=m))||f));o._RF.pop()}}}));

System.register("chunks:///_virtual/LeaderboardDisplay.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,a,i,n,o,l,c;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,l=e.Label,c=e.Component}],execute:function(){var s,p,u,b,d;n._RF.push({},"5c7e4/Iz+pPcrqmKibw2qMt","LeaderboardDisplay",void 0);var f=o.ccclass,y=o.property;e("LeaderboardDisplay",(s=f("LeaderboardDisplay"),p=y({type:l}),s((d=r((b=function(e){function r(){for(var r,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r=e.call.apply(e,[this].concat(n))||this,a(r,"label",d,i(r)),r}return t(r,e),r.prototype.setLeaderboard=function(e){if(this.label){var r="Ranking\n";e.forEach((function(e,t){r+=t+1+". "+e.name+" : "+e.score+"\n"})),this.label.string=r}},r}(c)).prototype,"label",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=b))||u));n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./CatBlock.ts","./GameController.ts","./GridManager.ts","./InputNamePanel.ts","./LeaderboardDisplay.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});